<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TechLift Africa — One Page WebApp (Upgraded)</title>
  <meta name="description" content="TechLift Africa — training, certifications, partnerships across industries. Full demo with OTP email verification and billing/basket." />
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --muted:#6b7280; --accent:#0b5cff; --dark:#04293a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; color:var(--dark); background:linear-gradient(180deg,#f6f8fb 0%, #eef3fb 100%)}
    a{color:inherit}
    header{position:sticky;top:0;z-index:60;background:linear-gradient(90deg,var(--dark),#013a63); color:#fff;padding:14px 18px;box-shadow:0 6px 18px rgba(2,6,23,0.25)}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#0066ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:white}
    nav{display:flex;gap:8px;align-items:center;margin-left:18px}
    .menu{display:flex;gap:6px;align-items:center}
    .menu a{color:rgba(255,255,255,0.95);text-decoration:none;padding:8px 12px;border-radius:8px;font-weight:600;font-size:14px}
    .menu a:hover{background:rgba(255,255,255,0.06)}
    .right-actions{margin-left:auto;display:flex;gap:8px}
    .btn{background:var(--accent);color:white;padding:9px 14px;border-radius:8px;text-decoration:none;font-weight:700;border:none;cursor:pointer}
    .mobile-toggle{display:none;background:transparent;border:0;color:white;font-size:22px}
    .hero{display:flex;gap:20px;align-items:center;padding:40px 0;color:white}
    .hero h1{margin:0;font-size:34px;line-height:1.05}
    .hero p{margin:12px 0 0;color:rgba(255,255,255,0.9);font-size:16px}
    main{padding:30px 0}
    section{padding:36px 0;border-bottom:1px solid rgba(10,20,40,0.04)}
    h2{margin:0 0 12px 0;color:var(--dark);font-size:22px}
    p.lead{color:var(--muted);margin:0 0 18px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(12,20,40,0.06);border:1px solid rgba(10,20,40,0.04)}
    .small{font-size:13px;color:var(--muted)}
    .mega{position:relative}
    .dropdown{position:absolute;left:0;top:calc(100% + 8px);background:var(--card);min-width:320px;border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,0.12);display:none}
    .dropdown .col{min-width:160px;padding:6px}
    .menu-item{position:relative}
    .menu-item:hover .dropdown, .menu-item:focus-within .dropdown{display:flex;gap:12px}
    .searchbar{display:flex;gap:8px;align-items:center;background:rgba(255,255,255,0.06);padding:6px;border-radius:10px}
    .searchbar input{border:0;padding:8px;background:transparent;color:white;outline:none;width:220px}
    footer{padding:24px;background:#031c2b;color:#b6c6d6;text-align:center}
    @media(max-width:920px){
      .menu{display:none}
      .mobile-toggle{display:inline-block}
    }
    .drawer{position:fixed;inset:0;display:none}
    .drawer .backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.5)}
    .drawer .panel{position:absolute;right:0;top:0;height:100%;width:320px;background:var(--card);padding:18px;box-shadow:-10px 0 40px rgba(2,6,23,0.2);overflow:auto}
    .modal-bg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;background:rgba(2,6,23,0.45);z-index:70}
    .modal{background:var(--card);padding:18px;border-radius:12px;max-width:720px;width:100%;box-shadow:0 20px 60px rgba(2,6,23,0.2)}
    form input, form select, form textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(10,20,40,0.06);margin:8px 0}
    .muted{color:var(--muted)}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,#eef4ff,#f6fbff);border:1px solid rgba(10,20,40,0.03);font-weight:600;font-size:13px}
    .dashboard{display:none;padding:18px;background:linear-gradient(180deg,#ffffff,#fbfdff);border-radius:12px}
    .profile{display:flex;gap:12px;align-items:center}
    .avatar{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#ffd89b,#19547b);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
    .course-viewer video{width:100%;height:300px;background:#000;border-radius:8px}
    .lesson{padding:10px;border-radius:8px;border:1px solid rgba(10,20,40,0.04);margin:8px 0}
    @media(max-width:520px){.hero h1{font-size:22px}.hero{padding:20px 0}}
  </style>
  <!-- EmailJS SDK for client-side email sending (used for OTP demo) -->
  <script src="https://cdn.emailjs.com/sdk/2.3.2/email.min.js"></script>
</head>
<body>

<header>
  <div class="container" style="display:flex;align-items:center">
    <div style="display:flex;align-items:center">
      <div class="logo">TL</div>
      <div style="margin-left:10px">
        <div style="font-weight:800">TechLift Africa</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.85)">Training — Certifications — Partnerships</div>
      </div>
    </div>

    <nav style="display:flex;align-items:center;margin-left:20px;flex:1">
      <button class="mobile-toggle" id="openMobile" aria-label="Open menu">☰</button>

      <div class="menu" role="menubar">
        <div class="menu-item"><a href="#home">Home</a></div>
        <div class="menu-item"><a href="#about">About</a></div>

        <div class="menu-item mega" tabindex="0">
          <a href="#programs">Programs ▾</a>
          <div class="dropdown" role="menu" aria-label="Programs menu" id="programsMenu">
            <div class="col">
              <strong>Information Technology</strong>
              <ul class="small" style="padding-left:12px;margin-top:8px">
                <li><a href="#" class="course-link" data-course="Digital Literacy">Digital Literacy</a></li>
                <li><a href="#" class="course-link" data-course="Network Engineering (MikroTik)">Network Engineering</a></li>
                <li><a href="#" class="course-link" data-course="Cloud & DevOps">Cloud & DevOps</a></li>
                <li><a href="#" class="course-link" data-course="Cybersecurity">Cybersecurity</a></li>
                <li><a href="#" class="course-link" data-course="Data Science & AI">Data Science & AI</a></li>
              </ul>
            </div>
            <div class="col">
              <strong>Engineering & Tech</strong>
              <ul class="small" style="padding-left:12px;margin-top:8px">
                <li><a href="#" class="course-link" data-course="Mechanical & Electrical Basics">Mechanical & Electrical</a></li>
                <li><a href="#" class="course-link" data-course="Civil & Construction">Civil & Construction</a></li>
                <li><a href="#" class="course-link" data-course="Telecommunications">Telecommunications</a></li>
                <li><a href="#" class="course-link" data-course="Automation & Robotics">Automation & Robotics</a></li>
              </ul>
            </div>
            <div class="col">
              <strong>Business & Creative</strong>
              <ul class="small" style="padding-left:12px;margin-top:8px">
                <li><a href="#" class="course-link" data-course="Project Management (PMI-aligned)">Project Management</a></li>
                <li><a href="#" class="course-link" data-course="Finance & Accounting">Finance & Accounting</a></li>
                <li><a href="#" class="course-link" data-course="Digital Marketing">Digital Marketing</a></li>
                <li><a href="#" class="course-link" data-course="Graphic Design & Media">Graphic & Media</a></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="menu-item mega" tabindex="0">
          <a href="#trainings">Trainings ▾</a>
          <div class="dropdown">
            <div class="col"><strong>Healthcare & Public Health</strong><ul class="small" style="padding-left:12px;margin-top:8px"><li><a href="#" class="course-link" data-course="Community Health Worker">Community Health</a></li><li><a href="#" class="course-link" data-course="Lab Technician">Lab Tech</a></li><li><a href="#" class="course-link" data-course="EMT">EMT</a></li></ul></div>
            <div class="col"><strong>Agriculture</strong><ul class="small" style="padding-left:12px;margin-top:8px"><li><a href="#" class="course-link" data-course="Crop Science">Crop Science</a></li><li><a href="#" class="course-link" data-course="Smart Farming & AgriTech">AgriTech</a></li><li><a href="#" class="course-link" data-course="Food Processing">Food Processing</a></li></ul></div>
            <div class="col"><strong>Energy & Maritime</strong><ul class="small" style="padding-left:12px;margin-top:8px"><li><a href="#" class="course-link" data-course="Renewables">Renewables</a></li><li><a href="#" class="course-link" data-course="Oil & Gas Safety">Oil & Gas Safety</a></li><li><a href="#" class="course-link" data-course="Maritime Safety">Maritime Safety</a></li></ul></div>
          </div>
        </div>

        <div class="menu-item mega" tabindex="0">
          <a href="#certifications">Certifications ▾</a>
          <div class="dropdown">
            <div class="col"><strong>Partners</strong><ul class="small" style="padding-left:12px;margin-top:8px"><li>CompTIA</li><li>Cisco</li><li>AWS</li><li>MikroTik</li></ul></div>
            <div class="col"><strong>Industry Certs</strong><ul class="small" style="padding-left:12px;margin-top:8px"><li>ACCA</li><li>CIMA</li><li>PMI</li><li>NEBOSH</li></ul></div>
          </div>
        </div>

        <div class="menu-item"><a href="#billing" id="billingLink">Billing</a></div>

        <div class="menu-item"><a href="#partners">Partners</a></div>
        <div class="menu-item"><a href="#contact">Contact</a></div>
      </div>

      <div class="right-actions">
        <div class="searchbar" role="search" aria-label="Search courses">
          <input id="searchInput" placeholder="Search courses or industries" aria-label="Search courses" />
          <button class="btn" onclick="searchCourses()">Search</button>
        </div>
        <button class="btn" onclick="openAuth()" id="authBtn">Sign In</button>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <section id="home" style="display:flex;gap:20px;align-items:center">
    <div class="left" style="flex:1">
      <h1>TechLift Africa — Skills, Certification & Partnerships</h1>
      <p class="lead">Accelerating employability across Africa with industry-aligned training, accredited certifications, and strategic institutional partnerships.</p>
      <div class="hero-actions">
        <button class="btn" onclick="openAuth()">Start Learning</button>
        <a class="btn" style="background:#2b8a3e" href="#programs">View Programs</a>
      </div>

      <div style="margin-top:18px" class="chips">
        <div class="chip">Online</div>
        <div class="chip">Instructor-Led</div>
        <div class="chip">Cohorts</div>
        <div class="chip">Accredited</div>
      </div>
    </div>
    <div style="width:420px;max-width:42%">
      <div class="card">
        <h3>Why TechLift?</h3>
        <p class="small">Practical training, real-world labs, employer connections, and certification pathways with global partners.</p>
        <ul class="small" style="margin-top:12px">
          <li>Industry-vetted courses</li>
          <li>Hands-on labs & capstones</li>
          <li>Job placement assistance</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="about">
    <h2>About TechLift Africa</h2>
    <p class="lead">TechLift Africa provides modular training across every major industry area, with course pathways from beginner to specialist levels. We build local capacity by partnering with universities, employers, and certification bodies.</p>
    <div class="grid" style="margin-top:14px">
      <div class="card"><h3>Mission</h3><p class="small">To empower African youth and professionals with the skills employers demand.</p></div>
      <div class="card"><h3>Vision</h3><p class="small">A continent where skills and opportunities meet.</p></div>
      <div class="card"><h3>Accreditation</h3><p class="small">We pursue formal accreditation with global partners to give graduates recognised credentials.</p></div>
    </div>
  </section>

  <section id="programs">
    <h2>Programs & Courses</h2>
    <p class="lead">Explore our industry-aligned course categories. Click a course to view details and enroll (demo).</p>

    <div id="coursesGrid" class="grid" style="margin-top:12px">
      <!-- course cards populated by JS -->
    </div>
  </section>

  <section id="trainings">
    <h2>Upcoming Trainings</h2>
    <p class="lead">Cohort-based trainings start every quarter. Apply to reserve a seat.</p>
    <div class="grid" style="margin-top:12px">
      <div class="card"><h3>Full-Stack Web Development</h3><p class="small">12-week intensive cohort — capstone project included.</p><button class="btn" onclick="openEnroll('Full-Stack Web Development', 150)">Apply</button></div>
      <div class="card"><h3>MikroTik Network Engineering</h3><p class="small">Routing, switching & wireless — prepares for MTNA and MTCNA.</p><button class="btn" onclick="openEnroll('MikroTik Network Engineering', 120)">Apply</button></div>
      <div class="card"><h3>Cybersecurity Foundations</h3><p class="small">SOC workflows, incident response, and basic forensics.</p><button class="btn" onclick="openEnroll('Cybersecurity Foundations', 130)">Apply</button></div>
    </div>
  </section>

  <section id="certifications">
    <h2>Accreditation & Partners</h2>
    <p class="lead">We partner with leading certification bodies and academic institutions to ensure recognized credentials.</p>
    <div class="grid" style="margin-top:12px">
      <div class="card"><h3>Technology Partners</h3><p class="small">Cisco, AWS, Microsoft, MikroTik, CompTIA</p></div>
      <div class="card"><h3>Academic Partners</h3><p class="small">Local universities, polytechnics, and regional colleges — MOUs available.</p></div>
      <div class="card"><h3>Industry Partners</h3><p class="small">Employers and NGOs for internships & placements.</p></div>
    </div>
  </section>

  <section id="partners">
    <h2>Strategic Partners</h2>
    <p class="lead">Key organisations we collaborate with for accreditation, curricula, and placements.</p>
    <div class="grid" style="margin-top:12px">
      <div class="card"><h3>Global Bodies</h3><p class="small">WHO, FAO, ILO, UNESCO (partnerships by program)</p></div>
      <div class="card"><h3>Certification Bodies</h3><p class="small">PMI, ACCA, CIMA, NEBOSH, IATA</p></div>
      <div class="card"><h3>Corporate</h3><p class="small">Cloud providers, telcos, and tech firms for hiring pipelines.</p></div>
    </div>
  </section>

  <section id="billing">
    <h2>Billing & Payments</h2>
    <p class="lead">Manage payments for course enrollment. Choose mobile money (Orange or Lonestar) or card payment.</p>
    <div class="grid" style="margin-top:12px">
      <div class="card">
        <h3>Payment Demo</h3>
        <p class="small">This demo includes mock payment flows and hooks for real API integration.</p>
        <p class="small"><strong>Note:</strong> For production, implement server-side payment callbacks and secure transaction verification.</p>
        <div style="margin-top:12px">
          <button class="btn" onclick="openBillingDemo()">Open Billing Demo</button>
        </div>
      </div>
      <div class="card">
        <h3>Invoices</h3>
        <p class="small">Download invoices for completed payments (demo only).</p>
        <div id="invoiceList" class="small"></div>
      </div>
    </div>
  </section>

  <section id="contact">
    <h2>Contact & Office</h2>
    <p class="lead">Reach us to discuss partnerships, bulk training, or curriculum licensing.</p>
    <div class="grid" style="margin-top:12px">
      <div class="card">
        <h3>Contact</h3>
        <p class="small">Email: <a href="mailto:professorhudsonsiahk@gmail.com">professorhudsonsiahk@gmail.com</a></p>
        <p class="small">Location: Monrovia, Liberia</p>
        <button class="btn" onclick="openPartnerForm()">Partner With Us</button>
      </div>
      <div class="card">
        <h3>Subscribe</h3>
        <p class="small">Get training updates and cohort invites.</p>
        <form id="subscribeForm" onsubmit="event.preventDefault();subscribe()">
          <input id="subEmail" type="email" placeholder="Your email" required />
          <button class="btn" type="submit">Subscribe</button>
        </form>
      </div>
    </div>
  </section>

  <section id="dashboardArea">
    <h2>Account</h2>
    <div class="dashboard card" id="dashboard">
      <!-- user dashboard dynamic -->
    </div>
  </section>
</main>

<footer>
  <div class="container">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">
      <div>&copy; 2025 TechLift Africa — All rights reserved</div>
      <div style="font-size:13px;color:var(--muted)">Built for capacity, accredited for impact</div>
    </div>
  </div>
</footer>

<!-- Mobile Drawer -->
<div class="drawer" id="mobileDrawer" aria-hidden="true">
  <div class="backdrop" onclick="closeMobile()"></div>
  <div class="panel">
    <div style="display:flex;align-items:center;justify-content:space-between"><strong>Menu</strong><button onclick="closeMobile()">✕</button></div>
    <hr style="margin:12px 0" />
    <a href="#home" onclick="closeMobile()">Home</a>
    <a href="#programs" onclick="closeMobile()">Programs</a>
    <a href="#trainings" onclick="closeMobile()">Trainings</a>
    <a href="#certifications" onclick="closeMobile()">Certifications</a>
    <a href="#billing" onclick="closeMobile()">Billing</a>
    <a href="#partners" onclick="closeMobile()">Partners</a>
    <a href="#contact" onclick="closeMobile()">Contact</a>
    <hr />
    <button class="btn" style="width:100%;margin-top:8px" onclick="openAuth();closeMobile()">Sign In / Register</button>
  </div>
</div>

<!-- Auth Modal (register -> OTP) -->
<div class="modal-bg" id="authModal" role="dialog" aria-modal="true">
  <div class="modal" role="document">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>User Access</h3>
      <button onclick="closeAuth()" aria-label="Close">✕</button>
    </div>

    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn" onclick="showLogin()">Sign In</button>
      <button class="btn" style="background:#2d2d2d" onclick="showRegister()">Register</button>
    </div>

    <div id="loginBox" style="margin-top:16px;display:none">
      <h4>Sign In</h4>
      <form id="loginForm" onsubmit="event.preventDefault();loginUser()">
        <input id="loginEmail" type="email" placeholder="Email" required />
        <input id="loginPassword" type="password" placeholder="Password" required />
        <button class="btn" type="submit">Login</button>
      </form>
      <div style="margin-top:8px"><button class="btn" style="background:#6b7280" onclick="showForgot()">Forgot Password</button></div>
    </div>

    <div id="registerBox" style="margin-top:16px;display:none">
      <h4>Create Account</h4>
      <form id="registerForm" onsubmit="event.preventDefault();startRegister()">
        <input id="regName" type="text" placeholder="Full name" required />
        <input id="regEmail" type="email" placeholder="Email" required />
        <input id="regPassword" type="password" placeholder="Password (min 6 chars)" required />
        <select id="regRole"><option value="student">Student</option><option value="trainer">Trainer</option><option value="admin">Admin</option></select>
        <button class="btn" type="submit">Create Account & Send OTP</button>
      </form>
    </div>

    <div id="otpBox" style="margin-top:16px;display:none">
      <h4>Confirm your email</h4>
      <p class="small">We sent a 6-digit OTP to your email. Enter it here to verify your account.</p>
      <form id="otpForm" onsubmit="event.preventDefault();confirmOTP()">
        <input id="otpInput" placeholder="6-digit OTP" required />
        <button class="btn" type="submit">Verify</button>
      </form>
      <div style="margin-top:8px" class="small">Didn't get the email? <button onclick="resendOTP()" class="btn" style="background:#6b7280">Resend OTP</button></div>
    </div>

    <div id="firstTimeChangeBox" style="margin-top:16px;display:none">
      <h4>Change Password</h4>
      <p class="small">Set a new password for your account.</p>
      <form id="changePwdForm" onsubmit="event.preventDefault();changePasswordFirstTime()">
        <input id="newPwd" type="password" placeholder="New password (min 6 chars)" required />
        <input id="confirmPwd" type="password" placeholder="Confirm new password" required />
        <button class="btn" type="submit">Save & Continue</button>
      </form>
    </div>

    <div id="forgotBox" style="margin-top:16px;display:none">
      <h4>Reset Password (demo)</h4>
      <p class="small">Enter your email — we will send a reset OTP (demo uses same flow).</p>
      <form onsubmit="event.preventDefault();startPasswordReset()">
        <input id="forgotEmail" type="email" placeholder="Email" required />
        <button class="btn" type="submit">Send Reset OTP</button>
      </form>
    </div>
  </div>
</div>

<!-- Enroll Modal (payment step triggered here) -->
<div class="modal-bg" id="enrollModal">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center"><h3>Enroll</h3><button onclick="closeEnroll()">✕</button></div>
    <div id="enrollBody"></div>
  </div>
</div>

<!-- Billing modal (detailed) -->
<div class="modal-bg" id="billingModal">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center"><h3>Billing & Payment</h3><button onclick="closeBilling()">✕</button></div>
    <div id="billingBody"></div>
  </div>
</div>

<!-- Partner Form Modal -->
<div class="modal-bg" id="partnerModal">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center"><h3>Partner With TechLift Africa</h3><button onclick="closePartnerForm()">✕</button></div>
    <form onsubmit="event.preventDefault();submitPartner()">
      <input id="orgName" placeholder="Organization or University" required />
      <input id="orgEmail" type="email" placeholder="Contact email" required />
      <textarea id="orgNote" placeholder="Brief message"></textarea>
      <button class="btn" type="submit">Send Partnership Request</button>
    </form>
  </div>
</div>

<!-- Course Viewer Modal -->
<div class="modal-bg" id="courseViewerModal">
  <div class="modal" style="max-width:900px">
    <div style="display:flex;justify-content:space-between;align-items:center"><h3 id="cvTitle"></h3><button onclick="closeCourseViewer()">✕</button></div>
    <div class="course-viewer">
      <div id="cvContent"></div>
    </div>
  </div>
</div>

<script>
/* ============================
  Configuration (replace these)
   - EmailJS config for OTP sending (client-side)
   - In production, move email sending & payment verification to server
   - Demo data & localStorage used here
   ============================ */
emailjs.init('YOUR_EMAILJS_USER_ID'); // <- replace with your EmailJS user id
const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID';       // replace
const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';     // replace

/* ===========
  Demo Courses
   Each course includes lessons (basic demo)
   =========== */
const COURSES = [
  {id:1,category:'Information Technology',title:'Digital Literacy',level:'Beginner',desc:'Fundamentals of computer use, internet, and productivity.',price:25,lessons:[
    {id:1,title:'Intro to Computers',type:'video',content:'https://www.w3schools.com/html/mov_bbb.mp4'},
    {id:2,title:'Internet & Safety',type:'article',content:'https://example.com/internet-safety.pdf'}
  ]},
  {id:2,category:'Information Technology',title:'Network Engineering (MikroTik)',level:'Intermediate',desc:'Routing, switching & wireless - MTCNA path.',price:120,lessons:[
    {id:1,title:'Routing Basics',type:'video',content:'https://www.w3schools.com/html/mov_bbb.mp4'},
    {id:2,title:'Wireless & Antennas',type:'article',content:'https://example.com/wireless.pdf'}
  ]},
  {id:3,category:'Information Technology',title:'Cloud & DevOps',level:'Advanced',desc:'AWS/Azure fundamentals, CI/CD, containers.',price:200,lessons:[]},
  {id:4,category:'Engineering & Tech',title:'Mechanical & Electrical Basics',level:'Beginner',desc:'Foundational workshop for technicians.',price:40,lessons:[]},
  {id:5,category:'Business & Management',title:'Project Management (PMI-aligned)',level:'Professional',desc:'PMP prep and practical PM skills.',price:90,lessons:[]}
];

/* Utility functions */
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }
function getUsers(){ return JSON.parse(localStorage.getItem('tl_users')||'[]'); }
function saveUsers(u){ localStorage.setItem('tl_users', JSON.stringify(u)); }
function getCurrent(){ return JSON.parse(localStorage.getItem('tl_current')||'null'); }
function setCurrent(u){ localStorage.setItem('tl_current', JSON.stringify(u)); }

/* Populate courses grid (clickable details & enroll) */
const coursesGrid = document.getElementById('coursesGrid');
function renderCourses(list=COURSES){
  coursesGrid.innerHTML='';
  list.forEach(c=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<h3>${escapeHtml(c.title)}</h3>
      <div class="small">${escapeHtml(c.category)} • ${escapeHtml(c.level)}</div>
      <p class="small">${escapeHtml(c.desc)}</p>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class='btn' onclick="openEnroll('${encodeURIComponent(c.title)}', ${c.price}, ${c.id})">Enroll • $${c.price}</button>
        <button class='btn' style='background:#2d2d2d' onclick="openCourseDetails(${c.id})">Details</button>
      </div>`;
    coursesGrid.appendChild(card);
  });
}
renderCourses();

/* Search */
function searchCourses(){ const q=document.getElementById('searchInput').value.trim().toLowerCase(); if(!q){renderCourses();return} const res = COURSES.filter(c=> (c.title+c.category+c.desc+c.level).toLowerCase().includes(q)); renderCourses(res); }

/* Mobile drawer */
const mobileDrawer = document.getElementById('mobileDrawer');
document.getElementById('openMobile').addEventListener('click', ()=>{ mobileDrawer.style.display='block'; mobileDrawer.setAttribute('aria-hidden','false');});
function closeMobile(){ mobileDrawer.style.display='none'; mobileDrawer.setAttribute('aria-hidden','true'); }

/* Auth flow: register -> OTP -> verify -> create user -> login -> first-time change pw */
function openAuth(){ document.getElementById('authModal').style.display='flex'; showLogin(); }
function closeAuth(){ document.getElementById('authModal').style.display='none'; hideAllAuthBoxes(); }
function showLogin(){ hideAllAuthBoxes(); document.getElementById('loginBox').style.display='block'; }
function showRegister(){ hideAllAuthBoxes(); document.getElementById('registerBox').style.display='block'; }
function hideAllAuthBoxes(){ ['loginBox','registerBox','otpBox','firstTimeChangeBox','forgotBox'].forEach(id=>document.getElementById(id).style.display='none'); }

/* Email validation simple */
function isValidEmail(email){ const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; return re.test(String(email).toLowerCase()); }

/* OTP helpers */
function genOTP(){ return Math.floor(100000 + Math.random()*900000).toString(); }
function nowPlusMinutes(m){ return Date.now() + m*60*1000; }

/* Start registration: validate email & password, create pending user and send OTP via EmailJS */
function startRegister(){
  const name = document.getElementById('regName').value.trim();
  const email = document.getElementById('regEmail').value.trim().toLowerCase();
  const pwd = document.getElementById('regPassword').value;
  const role = document.getElementById('regRole').value;
  if(!isValidEmail(email)){ alert('Please enter a valid email'); return; }
  if(pwd.length < 6){ alert('Password must be at least 6 characters'); return; }
  const users = getUsers();
  if(users.find(u=>u.email===email)){ alert('Email already registered. Try signing in or resetting password.'); return; }
  const otp = genOTP();
  const otpExpiry = nowPlusMinutes(15); // OTP valid 15 minutes
  // Save pending user to localStorage (demo). In production, save to server.
  const pending = { id: Date.now(), name, email, pwd: btoa(pwd), role, otp, otpExpiry, verified:false, mustChangePassword:true, enrolled:[] };
  localStorage.setItem('tl_pending_'+email, JSON.stringify(pending));
  // Display OTP box
  hideAllAuthBoxes(); document.getElementById('otpBox').style.display='block';
  // Send OTP via EmailJS
  sendOTPEmail(name, email, otp);
  alert('OTP sent to ' + email + ' (check spam).');
}

/* Resend OTP */
function resendOTP(){
  const email = document.getElementById('regEmail').value.trim().toLowerCase() || document.getElementById('forgotEmail').value.trim().toLowerCase();
  const pending = JSON.parse(localStorage.getItem('tl_pending_'+email) || 'null');
  if(!pending){ alert('No pending registration found for this email. Please register again.'); return; }
  // regenerate otp
  const newOtp = genOTP();
  pending.otp = newOtp; pending.otpExpiry = nowPlusMinutes(15);
  localStorage.setItem('tl_pending_'+email, JSON.stringify(pending));
  sendOTPEmail(pending.name, email, newOtp);
  alert('New OTP sent.');
}

/* Send OTP via EmailJS (client-side)
   - Ensure you replaced EMAILJS_* and emailjs.init(USER_ID)
   - Template parameters should include: to_name, to_email, otp, message
*/
function sendOTPEmail(name, email, otp){
  const serviceID = EMAILJS_SERVICE_ID;
  const templateID = EMAILJS_TEMPLATE_ID;
  const templateParams = {
    to_name: name,
    to_email: email,
    otp: otp,
    message: `Your TechLift Africa verification code is ${otp}. It expires in 15 minutes.`
  };
  // emailjs.send returns a Promise
  if(!serviceID || !templateID){
    console.warn('EmailJS service/template ID not configured. OTP will not be sent. For demo, OTP is in console.');
    console.log('OTP for', email, 'is', otp);
    return;
  }
  emailjs.send(serviceID, templateID, templateParams)
    .then(function(response) {
       console.log('OTP Email sent', response.status, response.text);
    }, function(error) {
       console.error('Failed to send OTP email', error);
       alert('Failed to send OTP email (see console).');
    });
}

/* Confirm OTP */
function confirmOTP(){
  const otpInput = document.getElementById('otpInput').value.trim();
  // find pending user by email (either regEmail or forgotEmail)
  const email = (document.getElementById('regEmail').value || document.getElementById('forgotEmail').value).trim().toLowerCase();
  const pending = JSON.parse(localStorage.getItem('tl_pending_'+email) || 'null');
  if(!pending){ alert('No pending registration/reset found. Please register or request an OTP.'); return; }
  if(Date.now() > pending.otpExpiry){ alert('OTP expired. Request a new one.'); return; }
  if(otpInput !== pending.otp){ alert('Invalid OTP'); return; }
  // OTP valid: if this is registration, promote to users
  const users = getUsers();
  pending.verified = true;
  pending.verifiedAt = Date.now();
  users.push(pending);
  saveUsers(users);
  localStorage.removeItem('tl_pending_'+email);
  // set current
  setCurrent(pending);
  updateUIForUser(pending);
  alert('Email verified. Welcome, ' + pending.name + '. You will be asked to change your password on first login.');
  // Show first time change password
  hideAllAuthBoxes(); document.getElementById('firstTimeChangeBox').style.display = 'block';
}

/* Change password upon first time login */
function changePasswordFirstTime(){
  const newPwd = document.getElementById('newPwd').value;
  const confirm = document.getElementById('confirmPwd').value;
  if(newPwd.length < 6){ alert('Password must be 6+ chars'); return; }
  if(newPwd !== confirm){ alert('Passwords do not match'); return; }
  const user = getCurrent();
  if(!user){ alert('No current user found'); return; }
  user.pwd = btoa(newPwd);
  user.mustChangePassword = false;
  // update stored user
  const users = getUsers(); const idx = users.findIndex(u=>u.email===user.email);
  if(idx>=0){ users[idx] = user; saveUsers(users); }
  setCurrent(user); updateUIForUser(user);
  alert('Password updated. You are now logged in.');
  closeAuth();
}

/* Login */
function loginUser(){
  const email = document.getElementById('loginEmail').value.trim().toLowerCase();
  const pwd = document.getElementById('loginPassword').value;
  const users = getUsers();
  const user = users.find(u => u.email === email && u.pwd === btoa(pwd));
  if(!user){ alert('Invalid credentials'); return; }
  // if user.mustChangePassword true, force password change
  setCurrent(user);
  if(user.mustChangePassword){
    hideAllAuthBoxes(); document.getElementById('firstTimeChangeBox').style.display='block';
    alert('First-time login: please change your password.');
    return;
  }
  updateUIForUser(user); closeAuth();
}

/* Forgot / Reset (demo uses same OTP flow) */
function showForgot(){ hideAllAuthBoxes(); document.getElementById('forgotBox').style.display='block'; }
function startPasswordReset(){
  const email = document.getElementById('forgotEmail').value.trim().toLowerCase();
  const users = getUsers(); const user = users.find(u=>u.email===email);
  if(!user){ alert('Email not found'); return; }
  // create pending reset object and save as tl_pending_email
  const otp = genOTP();
  const pending = { id:user.id, name:user.name, email:user.email, reset:true, otp, otpExpiry:nowPlusMinutes(15) };
  localStorage.setItem('tl_pending_'+email, JSON.stringify(pending));
  sendOTPEmail(user.name, email, otp);
  hideAllAuthBoxes(); document.getElementById('otpBox').style.display='block';
  alert('Reset OTP sent to email.');
}

/* Logout */
function logoutUser(){ localStorage.removeItem('tl_current'); updateUIForUser(null); alert('Logged out'); }

/* Update UI for logged-in user: dashboard, enrollments, invoices */
function updateUIForUser(user){
  const authBtn = document.getElementById('authBtn');
  const dashboard = document.getElementById('dashboard');
  if(user){
    authBtn.textContent = 'Account';
    authBtn.onclick = ()=>{ document.getElementById('dashboardArea').scrollIntoView({behavior:'smooth'}); };
    dashboard.style.display = 'block';
    const initials = (user.name||'U').split(' ').map(s=>s[0]).join('').slice(0,2).toUpperCase();
    dashboard.innerHTML = `<div class='profile'>
      <div class='avatar'>${escapeHtml(initials)}</div>
      <div><strong>${escapeHtml(user.name)}</strong><div class='small'>${escapeHtml(user.email)} • ${escapeHtml(user.role)}</div></div>
      <div style='margin-left:auto'><button class='btn' onclick='logoutUser()' style='background:#ef4444'>Logout</button></div>
    </div>
    <hr style='margin:12px 0' />
    <div id='enrollmentsArea'><h4>Your Enrollments</h4><div id='enrolledList' class='small'></div></div>
    <div style='margin-top:12px'><h4>Account Actions</h4><div style='display:flex;gap:8px;margin-top:8px'><button class='btn' onclick='openBillingDemo()'>Billing</button><button class='btn' style='background:#6b7280' onclick='openProfileEditor()'>Edit Profile</button></div></div>`;
    renderEnrolled(user);
    renderInvoices();
  } else {
    authBtn.textContent = 'Sign In';
    authBtn.onclick = openAuth;
    dashboard.style.display = 'none';
  }
}

/* Render enrolled courses for user */
function renderEnrolled(user){
  const el = document.getElementById('enrolledList');
  if(!user || !user.enrolled || user.enrolled.length===0){ el.innerHTML = 'No enrollments yet.'; return; }
  el.innerHTML = user.enrolled.map(e=>{
    // e may be {title, courseId, paid, date}
    const paid = e.paid ? 'Paid' : 'Pending';
    return `<div style="margin:6px 0;padding:8px;border-radius:8px;background:#fbfdff;border:1px solid rgba(10,20,40,0.03)">
      <strong>${escapeHtml(e.title)}</strong> <div class="small">${paid} • ${new Date(e.date).toLocaleString()}</div>
      <div style="margin-top:8px"><button class="btn" onclick="openCourseViewer(${e.courseId})">Open Course</button> ${e.paid?`<button class="btn" style="background:#2d2d2d" onclick="downloadCertificate(${e.courseId})">Certificate</button>`:`<button class="btn" style="background:#2b8a3e" onclick="openBilling('${encodeURIComponent(e.title)}', ${getCourseById(e.courseId).price}, ${e.courseId})">Pay Now</button>`}</div>
    </div>`;
  }).join('');
}

/* Download certificate (demo) */
function downloadCertificate(courseId){
  const user = getCurrent();
  if(!user) { alert('Sign in to download certificate'); return; }
  alert('Certificate generation (demo). In production, generate signed PDF server-side.');
}

/* Helper to get course by id */
function getCourseById(id){ return COURSES.find(c=>c.id===id); }

/* Open enroll modal: show price & proceed to payment */
function openEnroll(titleEncoded, price=0, courseId=null){
  const title = decodeURIComponent(titleEncoded);
  const modal = document.getElementById('enrollModal'); modal.style.display='flex';
  document.getElementById('enrollBody').innerHTML = `<p class='small'>You are enrolling in: <strong>${escapeHtml(title)}</strong></p>
    <p class='small'>Price: <strong>$${price}</strong></p>
    <div style='margin-top:12px;display:flex;gap:8px'>
      <button class='btn' onclick="startEnrollPayment('${encodeURIComponent(title)}', ${price}, ${courseId})">Proceed to Payment</button>
      <button class='btn' style='background:#6b7280' onclick='closeEnroll()'>Cancel</button>
    </div>`;
}

/* Close enroll */
function closeEnroll(){ document.getElementById('enrollModal').style.display='none'; }

/* Start payment process: open billing modal */
function startEnrollPayment(titleEnc, price, courseId){
  closeEnroll();
  openBilling(titleEnc, price, courseId);
}

/* Open Billing modal with payment options */
function openBilling(titleEnc, price=0, courseId=null){
  const title = decodeURIComponent(titleEnc);
  const body = document.getElementById('billingBody');
  body.innerHTML = `<p class="small">Pay for <strong>${escapeHtml(title)}</strong> — Amount: <strong>$${price}</strong></p>
    <div style="margin-top:12px;display:grid;grid-template-columns:1fr;gap:8px">
      <div style="padding:10px;border-radius:8px;background:#fbfdff">
        <strong>Orange Money</strong>
        <p class="small">Pay using Orange Money (demo flow)</p>
        <input id="omPhone" placeholder="Mobile number (e.g. 231775123456)" />
        <button class="btn" onclick="processOrangeMoney('${encodeURIComponent(title)}', ${price}, ${courseId})">Pay with Orange</button>
      </div>
      <div style="padding:10px;border-radius:8px;background:#fbfdff">
        <strong>Lonestar Cell (MTN / Lonestar Mobile Money)</strong>
        <p class="small">Pay using Lonestar Mobile Money (demo flow)</p>
        <input id="lmPhone" placeholder="Mobile number (e.g. 231777123456)" />
        <button class="btn" onclick="processLonestar('${encodeURIComponent(title)}', ${price}, ${courseId})">Pay with Lonestar</button>
      </div>
      <div style="padding:10px;border-radius:8px;background:#fbfdff">
        <strong>Card Payment (UI Only)</strong>
        <p class="small">Card integration requires server-side tokenization (Stripe/Paystack/etc.). Demo will simulate success.</p>
        <input id="cardName" placeholder="Cardholder name" />
        <input id="cardNumber" placeholder="Card number (demo)" />
        <button class="btn" onclick="processCard('${encodeURIComponent(title)}', ${price}, ${courseId})">Pay with Card (Demo)</button>
      </div>
    </div>
    <div style="margin-top:12px"><button class="btn" onclick="closeBilling()">Close</button></div>`;
  document.getElementById('billingModal').style.display='flex';
}

/* Close billing */
function closeBilling(){ document.getElementById('billingModal').style.display='none'; }

/* Mock/process Orange Money: UI demo and server hook example */
function processOrangeMoney(titleEnc, price, courseId){
  const phone = document.getElementById('omPhone').value.trim();
  if(!phone){ alert('Enter phone number'); return; }
  // Demo: simulate OTP confirmation and success
  alert('Initiating Orange Money transaction (demo). You will receive a prompt on your phone (simulated).');
  // In production: POST to your server endpoint which handles Orange Money API integration, e.g.:
  /* Example:
     fetch('/api/pay/orange', {
       method:'POST', headers:{'Content-Type':'application/json'},
       body: JSON.stringify({phone,amount:price,courseId, userEmail: getCurrent()?.email})
     }).then(... verify callback ...)
  */
  setTimeout(()=>{ paymentSuccess(titleEnc, price, courseId, 'Orange Money', phone); }, 1800);
}

/* Mock/process Lonestar (MTN) */
function processLonestar(titleEnc, price, courseId){
  const phone = document.getElementById('lmPhone').value.trim();
  if(!phone){ alert('Enter phone number'); return; }
  alert('Initiating Lonestar Mobile Money transaction (demo).');
  // Real integration: call your server which uses Lonestar / MTN API with credentials & callbacks
  setTimeout(()=>{ paymentSuccess(titleEnc, price, courseId, 'Lonestar Mobile Money', phone); }, 1800);
}

/* Mock/process Card */
function processCard(titleEnc, price, courseId){
  const name = document.getElementById('cardName').value.trim();
  const number = document.getElementById('cardNumber').value.trim();
  if(!name || !number){ alert('Enter card details (demo)'); return; }
  alert('Processing card (demo). For production, integrate Stripe/Paystack with server-side tokens.');
  setTimeout(()=>{ paymentSuccess(titleEnc, price, courseId, 'Card', 'card-'+number.slice(-4)); }, 1200);
}

/* Payment success handler: record invoice & mark enrollment paid */
function paymentSuccess(titleEnc, price, courseId, method, reference){
  closeBilling();
  const user = getCurrent();
  const title = decodeURIComponent(titleEnc);
  const now = new Date().toISOString();
  // Ensure user signed in
  if(!user){ alert('Sign in to complete payment.'); openAuth(); return; }
  // Add enrollment (if not exists)
  user.enrolled = user.enrolled || [];
  const exists = user.enrolled.find(e=>e.courseId === courseId);
  if(exists){
    exists.paid = true; exists.method = method; exists.ref = reference; exists.date = now;
  } else {
    user.enrolled.push({ title, courseId, paid:true, method, ref:reference, date: now });
  }
  // Save invoice
  const invoices = JSON.parse(localStorage.getItem('tl_invoices')||'[]');
  invoices.push({ id: Date.now(), userEmail: user.email, title, courseId, amount: price, method, reference, date: now });
  localStorage.setItem('tl_invoices', JSON.stringify(invoices));
  // Persist user
  const users = getUsers(); const idx = users.findIndex(u=>u.email===user.email);
  if(idx>=0){ users[idx] = user; saveUsers(users); setCurrent(user); updateUIForUser(user); }
  alert('Payment successful. Enrollment confirmed for ' + title);
}

/* Open billing demo directly */
function openBillingDemo(){ openBilling(encodeURIComponent('Demo Course'), 10, 0); }

/* Render invoices list (dashboard) */
function renderInvoices(){
  const list = document.getElementById('invoiceList');
  const invoices = JSON.parse(localStorage.getItem('tl_invoices')||'[]');
  if(!list) return;
  if(invoices.length===0){ list.innerHTML = '<div class="small">No invoices yet.</div>'; return; }
  list.innerHTML = invoices.slice(-5).reverse().map(inv=>`<div style="margin:6px 0">#${inv.id} • ${escapeHtml(inv.title)} • $${inv.amount} • ${escapeHtml(inv.method)} • ${new Date(inv.date).toLocaleString()}</div>`).join('');
}

/* Enroll flow via "Pay Now" in dashboard */
function openBillingForEnrollment(title, price, courseId){ openBilling(encodeURIComponent(title), price, courseId); }

/* Course details & viewer */
function openCourseDetails(id){
  const c = getCourseById(id);
  if(!c){ alert('Course not found'); return; }
  openCourseViewer(id);
}

/* Course viewer opens a modal with lessons and progress saving */
function openCourseViewer(courseId){
  const user = getCurrent();
  if(!user){ alert('Please sign in to access course content.'); openAuth(); return; }
  const enrolled = user.enrolled && user.enrolled.find(e=>e.courseId===courseId && e.paid);
  if(!enrolled){ alert('You must be enrolled and paid to access this course.'); return; }
  const c = getCourseById(courseId);
  if(!c){ alert('Course not found'); return; }
  document.getElementById('cvTitle').textContent = c.title;
  const cv = document.getElementById('cvContent');
  const progressKey = `progress_${user.email}_${courseId}`;
  const progress = JSON.parse(localStorage.getItem(progressKey) || '{}');
  // Build viewer UI
  cv.innerHTML = `<p class="small">${escapeHtml(c.desc)}</p>
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
      <div style="flex:1;min-width:280px">
        <div style="background:#fbfdff;padding:12px;border-radius:8px"><strong>Lessons</strong>
          ${c.lessons && c.lessons.length? c.lessons.map(les=>`<div class="lesson">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div><strong>${escapeHtml(les.title)}</strong><div class="small">${escapeHtml(les.type)}</div></div>
              <div><button class="btn" onclick="openLesson(${courseId}, ${les.id})">Open</button></div>
            </div>
          </div>`).join('') : '<div class="small">No lessons yet.</div>'}
        </div>
      </div>
      <div style="flex:1;min-width:260px">
        <div style="background:#fbfdff;padding:12px;border-radius:8px"><strong>Progress</strong>
          <div class="small" id="progressStatus">${Object.keys(progress).length? `Completed ${Object.keys(progress).length} / ${c.lessons.length}` : 'No progress yet.'}</div>
          <div style="margin-top:12px"><button class="btn" onclick="completeCourse(${courseId})">Mark Course Complete</button></div>
        </div>
      </div>
    </div>
    <div style="margin-top:12px"><button class="btn" onclick="closeCourseViewer()">Close</button></div>
  `;
  document.getElementById('courseViewerModal').style.display='flex';
}

/* Close viewer */
function closeCourseViewer(){ document.getElementById('courseViewerModal').style.display='none'; }

/* Open a lesson: if video, show video; if article, open link in new tab */
function openLesson(courseId, lessonId){
  const user = getCurrent(); if(!user){ alert('Sign in to view lesson'); openAuth(); return; }
  const c = getCourseById(courseId); if(!c) return;
  const lesson = c.lessons.find(l=>l.id===lessonId);
  if(!lesson){ alert('Lesson not found'); return; }
  // In viewer modal, show content
  const cv = document.getElementById('cvContent');
  let contentHtml = '';
  if(lesson.type === 'video'){
    contentHtml = `<video controls src="${lesson.content}"></video>`;
  } else if(lesson.type === 'article'){
    contentHtml = `<p class="small">Article / resource — <a href="${lesson.content}" target="_blank">Open resource</a></p>`;
  } else {
    contentHtml = `<p class="small">Lesson content: ${escapeHtml(lesson.content)}</p>`;
  }
  // Mark progress
  const progressKey = `progress_${user.email}_${courseId}`;
  const progress = JSON.parse(localStorage.getItem(progressKey) || '{}');
  progress[lessonId] = { completedAt: Date.now() };
  localStorage.setItem(progressKey, JSON.stringify(progress));
  // Reopen course viewer content with lesson displayed
  document.getElementById('cvContent').innerHTML = `<div>${contentHtml}</div><div style="margin-top:12px"><button class="btn" onclick="openCourseViewer(${courseId})">Back to course</button></div>`;
}

/* Mark course complete (demo) */
function completeCourse(courseId){
  const user = getCurrent(); if(!user){ alert('Sign in first'); openAuth(); return; }
  const c = getCourseById(courseId);
  alert('Course "' + c.title + '" marked as complete (demo). In production, trigger certificate generation and store completion server-side.');
}

/* Course details quick view */
function openCourseDetailsByTitle(title){
  const c = COURSES.find(x => x.title === title);
  if(c) openCourseViewer(c.id); else alert('Course not found: ' + title);
}

/* Make menu course links clickable */
document.querySelectorAll('.course-link').forEach(a => {
  a.addEventListener('click', (e) => {
    e.preventDefault();
    const title = a.getAttribute('data-course');
    // find course by title
    const c = COURSES.find(x => x.title.toLowerCase() === title.toLowerCase());
    if(c) openCourseViewer(c.id);
    else alert('Course details not available in demo: ' + title);
  });
});

/* Enrollment - user must sign in. This creates a pending enrollment that requires payment */
function enrollCourse(titleEnc, courseId){
  const user = getCurrent();
  if(!user){ alert('Sign in to enroll'); openAuth(); return; }
  const title = decodeURIComponent(titleEnc);
  // push to user.enrolled with paid:false
  user.enrolled = user.enrolled || [];
  if(user.enrolled.find(e => e.courseId === courseId)){ alert('Already enrolled'); return; }
  user.enrolled.push({ title, courseId, paid:false, date: new Date().toISOString() });
  const users = getUsers(); const idx = users.findIndex(u=>u.email===user.email); if(idx>=0){ users[idx]=user; saveUsers(users); setCurrent(user); updateUIForUser(user); }
  alert('Enrollment created. Please pay to access course content.');
}

/* For convenience, enroll + redirect to billing */
function enrollAndPay(titleEnc, price, courseId){
  enrollCourse(titleEnc, courseId);
  openBilling(titleEnc, price, courseId);
}

/* Partner form */
function openPartnerForm(){ document.getElementById('partnerModal').style.display='flex'; }
function closePartnerForm(){ document.getElementById('partnerModal').style.display='none'; }
function submitPartner(){ const n=document.getElementById('orgName').value; const e=document.getElementById('orgEmail').value; alert('Partnership request sent — we will contact ' + n); closePartnerForm(); }

/* Subscribe */
function subscribe(){ const e=document.getElementById('subEmail').value; alert('Subscribed: ' + e); document.getElementById('subEmail').value=''; }

/* Course details open helper */
function openCourseDetails(id){ openCourseViewer(id); }

/* Helper when page loads from anchor to close mobile drawer */
if(window.location.hash) setTimeout(()=>{ document.querySelector(window.location.hash)?.scrollIntoView({behavior:'smooth'}) }, 300);

/* Accessibility: close modals on ESC */
document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ document.querySelectorAll('.modal-bg').forEach(m=>m.style.display='none'); closeMobile(); } });

/* Init UI: check current user */
updateUIForUser(getCurrent());
renderInvoices();

/* Demo: helper to prefill regEmail when editing/resending OTP */
document.getElementById('regEmail')?.addEventListener('input', ()=>{ /* noop */ });

/* ===========================
  Notes for Real Integration
  - Move user registration, password storage, OTP generation & verification to server-side.
  - Use server to send emails (e.g., SendGrid, SES) securely — do not rely on client-side EmailJS for production.
  - Implement payment provider webhooks & server-side verification for Orange Money and Lonestar/MTN.
  - Store invoices, enrollments, certificates in a database.
  - Use secure password hashing (bcrypt) on the server.
  =========================== */

</script>
</body>
</html>
